<div class="container my-4">
  <h2>Editar propiedad</h2>

  <div *ngIf="cargando" class="text-muted">Cargando datos...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Mensaje según estado -->
  <div
    *ngIf="!cargando && !error"
    class="alert"
    [ngClass]="{ 'alert-info': !aprobada, 'alert-warning': aprobada }"
  >
    <ng-container *ngIf="aprobada; else libreEdicion">
      Esta propiedad ya está aprobada. Solo puedes modificar
      la <strong>descripción</strong> y el <strong>precio</strong>.
    </ng-container>
    <ng-template #libreEdicion>
      Esta propiedad aún está pendiente de aprobación. Puedes modificar todos los datos.
    </ng-template>
  </div>

  <form
    *ngIf="!cargando && !error"
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    class="mt-3"
  >

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Título</label>
        <input type="text" class="form-control" formControlName="titulo" />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Ciudad</label>
        <input type="text" class="form-control" formControlName="ciudad" />
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Dirección</label>
      <input type="text" class="form-control" formControlName="direccion" />
    </div>

    <div class="mb-3">
      <label class="form-label">Descripción</label>
      <textarea rows="3" class="form-control" formControlName="descripcion"></textarea>
    </div>

    <!-- Tipo -->
    <div class="mb-3">
      <label class="form-label">Tipo</label>
      <select class="form-select" formControlName="tipo">
        <option value="casa">Casa</option>
        <option value="departamento">Departamento</option>
        <option value="parcela">Parcela</option>
        <option value="terreno">Terreno</option>
        <option value="oficina">Oficina</option>
        <option value="bodega">Bodega</option>
      </select>
    </div>

    <!-- Dormitorios y baños -->
    <div
      class="row"
      *ngIf="form.value.tipo !== 'terreno' && form.value.tipo !== 'parcela'"
    >
      <div class="col-md-6 mb-3">
        <label class="form-label">Dormitorios</label>
        <input type="number" class="form-control" formControlName="dormitorios" min="0" />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Baños</label>
        <input type="number" class="form-control" formControlName="baos" min="0" />
      </div>
    </div>

    <div
      *ngIf="form.value.tipo === 'terreno' || form.value.tipo === 'parcela'"
      class="mb-3 text-muted"
    >
      Esta propiedad es un terreno/parcela, por lo que no tiene dormitorios ni baños.
    </div>

    <!-- Otros campos -->
    <div class="row mt-3">
      <div class="col-md-4 mb-3">
        <label class="form-label">Metros cuadrados</label>
        <input type="number" class="form-control" formControlName="metros2" min="0" />
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Orientación</label>
        <select class="form-select" formControlName="orientación">
          <option value="sur">Sur</option>
          <option value="norte">Norte</option>
          <option value="este">Este</option>
          <option value="oeste">Oeste</option>
        </select>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Precio</label>
        <input type="number" class="form-control" formControlName="precio" min="0" />
      </div>
    </div>

    <!-- Estado -->
    <div class="mb-3">
      <label class="form-label">Estado</label>
      <select class="form-select" formControlName="estado">
        <option value="disponible">Disponible</option>
        <option value="reservada">Reservada</option>
        <option value="arrendada">Arrendada</option>
        <option value="vendida">Vendida</option>
      </select>
    </div>

    <!-- Botones -->
    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="button" class="btn btn-outline-secondary" [routerLink]="['/mis-propiedades']">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="enviando || form.invalid">
        {{ enviando ? 'Guardando...' : 'Guardar cambios' }}
      </button>
    </div>
  </form>
</div>
