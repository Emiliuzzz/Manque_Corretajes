<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="mb-0">Catálogo de propiedades</h2>
      <small class="text-muted">Propiedades cargadas desde el sistema Manque</small>
    </div>
  </div>

  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <div class="row g-2 align-items-end">
        <div class="col-12 col-md-3">
          <label class="form-label">Ciudad</label>
          <input class="form-control" [(ngModel)]="filtros.ciudad" placeholder="Ej: Talca" />
        </div>

        <div class="col-12 col-md-2">
          <label class="form-label">Tipo</label>
          <select class="form-select" [(ngModel)]="filtros.tipo">
            <option value="">Todos</option>
            <option value="casa">Casa</option>
            <option value="departamento">Departamento</option>
            <option value="terreno">Terreno</option>
            <option value="parcela">Parcela</option>
          </select>
        </div>

        <div class="col-12 col-md-2">
          <label class="form-label">Estado</label>
          <select class="form-select" [(ngModel)]="filtros.estado">
            <option value="">Todos</option>
            <option value="disponible">Disponible</option>
            <option value="reservada">Reservada</option>
            <option value="vendida">Vendida</option>
            <option value="arrendada">Arrendada</option>
          </select>
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Precio mín.</label>
          <input class="form-control" type="number" [(ngModel)]="filtros.precio_min" placeholder="0" />
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Precio máx.</label>
          <input class="form-control" type="number" [(ngModel)]="filtros.precio_max" placeholder="999999999" />
        </div>

        <div class="col-12 col-md-1 d-grid">
          <button class="btn btn-primary" type="button" (click)="buscar()">Filtrar</button>
        </div>

        <div class="col-12 col-md-2 d-grid">
          <button class="btn btn-outline-secondary" type="button" (click)="limpiar()">Limpiar</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Mensajes de estado -->
  <div *ngIf="cargando" class="alert alert-info py-2">Cargando propiedades...</div>
  <div *ngIf="error" class="alert alert-danger py-2">{{ error }}</div>

  <!-- Lista de propiedades -->
  <div class="row g-3">
    <div class="col-md-4" *ngFor="let p of propiedades">
      <div class="card h-100 shadow-sm">
        <!-- Imagen principal -->
        <ng-container *ngIf="p.fotos && p.fotos.length > 0; else sinFoto">
          <img
            [src]="p.fotos[0].url"
            class="card-img-top"
            style="height: 180px; object-fit: cover;"
          />
        </ng-container>
        <ng-template #sinFoto>
          <div
            class="d-flex align-items-center justify-content-center bg-secondary text-white"
            style="height: 180px;"
          >
            <span>Sin foto disponible</span>
          </div>
        </ng-template>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ p.titulo }}</h5>
          <p class="card-text mb-1">
            <strong>{{ p.ciudad }}</strong> · {{ p.tipo | titlecase }}
          </p>
          <p class="card-text mb-1">
            Dormitorios: {{ p.dormitorios }} · Baños: {{ p.baos }}
          </p>
          <p class="card-text fw-semibold text-success mb-3">
            {{ p.precio | currency:'CLP':'symbol':'1.0-0' }}
          </p>
          <div class="mt-auto">
            <a
              [routerLink]="['/propiedad', p.id]"
              class="btn btn-primary btn-sm w-100"
            >
              Ver detalle
            </a>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!cargando && !error && propiedades.length === 0" class="col-12">
      <div class="alert alert-warning">No se encontraron propiedades.</div>
    </div>
  </div>
</div>
